# 14-1. JDBC ê²Œì‹œíŒ(23íšŒì°¨(3/22))

## ê²Œì‹œíŒ ë§Œë“¤ê¸°

### 1. MySQL TABLE ì‘ì„±

- í…Œì´ë¸”1: users
    
    ```sql
    create table users(
    userid varchar(20) primary key,
    username varchar(20) not null,
    password varchar(20)  not null,
    age int(3) not null,
    email varchar(40) not null);
    desc users;
    ```
    
- í…Œì´ë¸”2: boards
    
    ```sql
    create table boards(
    bno int primary key auto_increment, -- ìë™ ì¦ê°€
    btitle varchar(20) not null,
    bcontent longtext not null,
    bwriter varchar(30) not null,
    bdate datetime default now(),
    bfilename varchar(50) null,
    bfiledata longblob null); -- binary large object(ì´ë¯¸ì§€ë‚˜ ì˜¤ë””ì˜¤ ê°™ì€ê±¸ ê°ì²´ í˜•íƒœë¡œ ë„£ìŒ)
    ```
    

### 2. JDBC ì—°ê²°

- JDBCë¥¼ ì´ìš©í•´ ì´í´ë¦½ìŠ¤ - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë°©ë²•( import.java.sql.*; )
    1. JDBC ë“œë¼ì´ë²„ ë¡œë“œ
    2. ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°
    3. SQLë¬¸ ì‹¤í–‰
    4. ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²° ëŠê¸°
- ì—°ê²°í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” java api
    - Connection: ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°
    - Statement: ì§ˆì˜, ê°±ì‹ , ì‹¤í–‰
    - ResultSet: ê²°ê³¼ë¬¼
- ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°í•˜ëŠ” ì‘ì—…(3. SQLë¬¸ ì‹¤í–‰ê³¼ì •ì€ ì—†ìŒ)
    
    ```java
    import java.sql.Connection;
    import java.sql.DriverManager;
    import java.sql.SQLException;
    
    public class Jdbc {
    
    	public static void main(String[] args) throws SQLException {
    		
    		Connection conn = null;
    		
    		try {
    			Class.*forName*("com.mysql.cj.jdbc.Driver");
    			//1. Class í´ë˜ìŠ¤ë¡œ JDBC ë“œë¼ì´ë²„ë¥¼ ë¡œë”©
    			//DriverManagerì— ë“±ë¡ë¨ â†’ ì´ê±°ë¥¼ ê°€ì§€ê³  SQLê³¼ ì—°ê²°
    			
    			conn = DriverManager.getConnection(
    					"jdbc:mysql://localhost:3306/sjh", //URL
    					"root",							   //id
    					"1234"							   //pw
    					);
    			//connectionì€ ì¸í„°í˜ì´ìŠ¤ë¼ ê°ì²´ìƒì„± ë¶ˆê°€, DriverManager í´ë˜ìŠ¤ë¡œ ìƒì†ë°›ì•„ì•¼í•¨
    			//2. Connection ê°ì²´ ìƒì„±í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°ì´ ì´ë£¨ì–´ì§€ë„ë¡ í•¨			
    			
    			//3. sqlë¬¸ ì‹¤í–‰
    			
    		}catch(Exception e) {}
    		
    		conn.close(); //4. ì—°ê²°ëŠê¸°
    	}
    }
    ```
    
- SQLë¬¸ í¬í•¨ì‹œ
    
    ```java
    import java.sql.Connection;
    import java.sql.DriverManager;
    import java.sql.PreparedStatement;
    import java.sql.SQLException;
    
    public class Jdbc {
    	public static void main(String[] args) throws SQLException {
    		
    		Connection conn = null;
    		
    		try {
    			Class.*forName*("com.mysql.cj.jdbc.Driver");
    			//1. Class í´ë˜ìŠ¤ë¡œ JDBC ë“œë¼ì´ë²„ë¥¼ ë¡œë”©
    			//DriverManagerì— ë“±ë¡ë¨ â†’ ì´ê±°ë¥¼ ê°€ì§€ê³  SQLê³¼ ì—°ê²°
    			
    			conn = DriverManager.getConnection(
    					"jdbc:mysql://localhost:3306/sjh", //URL
    					"root",							   //id
    					"1234"							   //pw
    					);
    			//connectionì€ ì¸í„°í˜ì´ìŠ¤ë¼ ê°ì²´ìƒì„± ë¶ˆê°€, DriverManager í´ë˜ìŠ¤ë¡œ ìƒì†ë°›ì•„ì•¼í•¨
    			//2. Connection ê°ì²´ ìƒì„±í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°ì´ ì´ë£¨ì–´ì§€ë„ë¡ í•¨			
    			
    			//3. sqlë¬¸ ì‹¤í–‰
    			//ë°ì´í„°ë² ì´ìŠ¤ 'users' í…Œì´ë¸”ì— ë°ì´í„° ë„£ê¸°
    			String sql = "INSERT INTO users(userid, username, password, age, email) "
    						+ "VALUES(?,?,?,?,?)"; //?: ë°”ì¸ë“œ ë³€ìˆ˜. ë§¤ë²” ê°’ì´ ë°”ë€” ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë¯¸ë¦¬ ì •í•´ë†“ì§€ ì•ŠìŒ
    			
    			//PreparedStatement ì¸í„°í˜ì´ìŠ¤, connìœ¼ë¡œë¶€í„° í•¨ìˆ˜í˜¸ì¶œí•´ì„œ ê°ì²´ ìƒì„±
    			PreparedStatement pstmt = conn.prepareStatement(sql);
    			
    			//ê°’ì„ ë„£ëŠ” ì‘ì—…. setìë£Œí˜•(?ì íŒ ìˆœì„œ, ë°ì´í„°)
    			pstmt.setString(1, "com");
    			pstmt.setString(2, "tom");
    			pstmt.setString(3, "1234");
    			pstmt.setInt(4, 49);
    			pstmt.setString(5, "aa@naver.com");
    			
    			//executeXXX: ì¿¼ë¦¬ë¬¸ì´ ì‹¤í–‰ë˜ê¸° ìœ„í•´ í˜¸ì¶œí•˜ëŠ” ë§¤ì†Œë“œ: ë°ì´í„°ë² ì´ìŠ¤ ê°±ì‹ ë¨
    			int r = pstmt.executeUpdate();
    			
    			System.out.println("ê°±ì‹ ëœ í–‰ ê°¯ìˆ˜: "+r); //ì—…ë°ì´íŠ¸ëë‚˜ í™•ì¸
    			
    			pstmt.close();			
    		}catch(Exception e) {}
    		conn.close(); //4. ì—°ê²°ëŠê¸°
    	}
    }
    ```
    
- ì—°ê²°ë°©ë²• ìƒì„¸
    1. íŒ¨í‚¤ì§€ ìƒì„± â†’ mysql JDBC ë„£ê¸°
        
        <img src="/02. JAVA/00. img/15-1-1.png" width="400">
        
    2. Connection í´ë˜ìŠ¤  ê°ì²´ ìƒì„±
        - Connection conn = null;
        - Class.forName("com.mysql.cj.jdbc.Driver");
        
        <img src="/02. JAVA/00. img/15-1-2.png" width="400">
        
    3. DriverManagerì„ í†µí•´ í…Œì´í„°ë² ì´ìŠ¤ ì—°ê²°
        
        <img src="/02. JAVA/00. img/15-1-3.png" width="400">
        
    4. SQLë¬¸ ì‘ì„±
        - String sql = â€œì¿¼ë¦¬ë¬¸â€;
        - PreparedStatement pstmt = conn.prepareStatement(sql);
        - int r = pstmt.executeUpdate();
        
        <img src="/02. JAVA/00. img/15-1-4.png" width="400">
        
        <img src="/02. JAVA/00. img/15-1-5.png" width="400">
        
    5. ì—°ê²° ëŠê¸°
        - conn.close();
        
        <img src="/02. JAVA/00. img/15-1-6.png" width="400">
        

### 3. SQL ì‘ì„±(ë°ì´í„° ì‚½ì…, ë³€ê²½, ì‚­ì œ)

- ë°ì´í„° ì‚½ì…(INSERT INTO ~ VALUES)
    
    ```java
    package boards;
    
    import java.io.FileInputStream;
    import java.sql.Connection;
    import java.sql.DriverManager;
    import java.sql.PreparedStatement;
    import java.sql.ResultSet;
    import java.sql.SQLException;
    import java.sql.Statement;
    
    public class BoardInsert {
    	public static void main(String[] args) {
    
    		Connection conn = null;
    
    		try {
    			Class.forName("com.mysql.cj.jdbc.Driver");
    			conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/sjh", "root", "1234");
    
    			String sql = "INSERT INTO boards (btitle, bcontent, bwriter, bdate, bfilename,bfiledata) "
    					+ "VALUES (?, ?, ?, now(), ?, ?)";
    
    			PreparedStatement pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
    			// sqlë§Œ ì ìœ¼ë©´ ì¿¼ë¦¬ë¬¸ ì‹¤í–‰ ì¤€ë¹„
    			// ìë™ì¦ê°€ëœ bnoê°’ ê°€ì ¸ì˜´: Statement.RETURN_GENERATED_KEYS
    			pstmt.setString(1, "ê¸ˆìš”ì¼");
    			pstmt.setString(2, "ê¸ˆìš”ì¼ì…ë‹ˆë‹¤");
    			pstmt.setString(3, "juli");
    			pstmt.setString(4, "ë§ê³°"); // bdateëŠ” now()ë¡œ ë“¤ì–´ê°€ì„œ ì•ˆë„£ì–´ë„ë¨
    			pstmt.setBlob(5, new FileInputStream("C://Users//bitcamp//Desktop/mang.jpg"));
    
    			int r = pstmt.executeUpdate();
    			System.out.println(r); // ê°±ì‹ ëœ í–‰ì˜ ê°œìˆ˜
    
    			if (r == 1) {
    				ResultSet rs = pstmt.getGeneratedKeys(); // bnoê°’
    				if (rs.next()) {
    					int bno = rs.getInt(1);// DBì—ì„œ ì»¬ëŸ¼ê°’ì´ 1ì„(ì²«ë²ˆì§¸ ì—´) = bno
    					System.out.println("ê²Œì‹œê¸€ ìˆ˜ " + bno);
    				}
    				rs.close();
    			}
    			pstmt.close();
    			conn.close();
    		} catch (Exception e) {
    		}
    	}
    }
    ```
    

- UPDTAE ~ SET
    
    ```java
    package boards;
    
    import java.io.FileInputStream;
    import java.sql.Connection;
    import java.sql.DriverManager;
    import java.sql.PreparedStatement;
    import java.sql.ResultSet;
    import java.sql.SQLException;
    import java.sql.Statement;
    
    public class BoardInsert {
    	public static void main(String[] args) {
    		Connection conn = null;
    		try {
    
    			String sql = new StringBuilder()
    					.append("UPDATE boards SET ")
    					.append("btitle= ?, ")
    					.append("bcontent= ?, ")
    					.append("bfilename= ?, ")
    					.append("bfiledata= ? ")
    					.append("WHERE bno= ?")
    					.toString();
    
    					PreparedStatement pstmt=conn.prepareStatement(sql);
    					pstmt.setString(1, "hi");
    					pstmt.setString(2, "hello");
    					pstmt.setString(3, "ì§±êµ¬.jpg");
    					pstmt.setBlob(4, new FileInputStream
    					("C://Users//bitcamp//Desktop/ì§±êµ¬.jpg"));
    					pstmt.setInt(5,1);
    
    					int r=pstmt.executeUpdate();
    					System.out.println("ìˆ˜ì •ëœ í–‰ ê°œìˆ˜" + r);
    					pstmt.close();	
    					
    		} catch (Exception e) {
    		}
    	}
    }
    ```
    

- DELETE
    
    ```java
    package boards;
    
    import java.io.FileInputStream;
    import java.sql.Connection;
    import java.sql.DriverManager;
    import java.sql.PreparedStatement;
    import java.sql.ResultSet;
    import java.sql.SQLException;
    import java.sql.Statement;
    
    public class BoardInsert {
    	public static void main(String[] args) {
    		Connection conn = null;
    		try {
    
    			Class.forName("com.mysql.cj.jdbc.Driver");
    			conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/sjh", "root", "1234");
    
    			String sql = "DELETE FROM boards WHERE bno=?";
    					
    			PreparedStatement pstmt = conn.prepareStatement(sql);
    			pstmt.setInt(1, 1);
    			
    			int r=pstmt.executeUpdate();
    			System.out.println(r);
    			
    			pstmt.close();					
    					
    		} catch (Exception e) {
    		}
    	}
    }
    ```
    

### 4. ì •ë³´ì¡°íšŒ

- TABLEì—ì„œ ìœ ì € ì •ë³´ë¥¼ ê°€ì ¸ì™€ ì½˜ì†”ì— ì¶œë ¥
    1. ìœ ì € ì •ë³´ë¥¼ ë°›ì„ ê°ì²´ ìƒì„±(User í´ë˜ìŠ¤ ìƒì„±)- getter / setter
        
        ```java
        package boards;
        
        public class User {
        	private String userid;
        	private String username;
        	private String password;
        	private int age;
        	private String email;
        	
        	public String getUserid() {
        		return userid;
        	}
        	public void setUserid(String userid) {
        		this.userid = userid;
        	}
        	public String getUsername() {
        		return username;
        	}
        	public void setUsername(String username) {
        		this.username = username;
        	}
        	public String getPassword() {
        		return password;
        	}
        	public void setPassword(String password) {
        		this.password = password;
        	}
        	public int getAge() {
        		return age;
        	}
        	public void setAge(int age) {
        		this.age = age;
        	}
        	public String getEmail() {
        		return email;
        	}
        	public void setEmail(String email) {
        		this.email = email;
        	}
        	@Override
        	public String toString() { //setí•œ ê°’ë“¤ì„ ë¬¸ìë¡œ ë³€í™˜
        		return userid+" "+username+" "+age; 
        	}
        }
        //í…Œì´ë¸”ì—ì„œ Users ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ í›„ ì½˜ì†”ì— ì¶œë ¥í•˜ê¸°ë¥¼ ì›í•¨
        ```
        
    2. SELECT ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì •ë³´ ë°›ê¸°
        
        ```java
        package boards;
        
        import java.sql.Connection;
        import java.sql.DriverManager;
        import java.sql.PreparedStatement;
        import java.sql.ResultSet;
        import java.sql.SQLException;
        import java.sql.Statement;
        
        public class UserSelect {
        	public static void main(String[] args) throws SQLException {
        		//í…Œì´ë¸”ì—ì„œ Users ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ í›„ ì½˜ì†”ì— ì¶œë ¥í•˜ê¸°ë¥¼ ì›í•¨
        
        		Connection conn = null;
        
        		try {
        			Class.forName("com.mysql.cj.jdbc.Driver");
        			conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/sjh", "root", "1234");
        			//connection ê°ì²´ ìƒì„±í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°
        			
        			String sql ="SELECT *FROM users WHERE userid=?";
        			
        			PreparedStatement pstmt = conn.prepareStatement(sql);
        			pstmt.setString(1, "com"); //useridê°€ comì¸ ë°ì´í„° ì¡°íšŒ
        			
        			//ResultSet : ë°˜í™˜ê°’ì´ ì—¬ëŸ¬ ê°œì˜ í–‰ì¸ ê²½ìš°ì— ì‰½ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ ì„¤ê³„ëœ í´ë˜ìŠ¤
        			ResultSet rs = pstmt.executeQuery(); //ì •ë³´ ê°€ì ¸ì™€ ResultSetì— ë„£ìŒ
        			if(rs.next()) { //ë‹¤ìŒí–‰ì´ ìˆë‹¤ë©´
        				User u = new User();
        				u.setUserid(rs.getString(1)); //1ì»¬ëŸ¼ì˜ ê°’ì„ getí•´ì„œ Useridì— setí•¨
        				//í…Œì´ë¸”ì— ì €ì¥ë˜ì–´ ìˆëŠ” useridê°’ì„ ê°€ì ¸ì™€ì„œ Userí´ë˜ìŠ¤ì— useridë¼ëŠ” í•„ë“œì— ì„¸íŒ…í•¨
        				//sysoutí•´ì„œ ì¶œë ¥í•  ìˆ˜ë„ ìˆì§€ë§Œ, ë‚˜ì¤‘ì— jspì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì„œ ì €ì¥í•´ì•¼í•  ë•Œ ì´ë ‡ê²Œ ì”€
        				u.setUsername(rs.getString("username")); //ì»¬ëŸ¼ ìˆ˜ê°€ ì•„ë‹ˆë¼ ì»¬ëŸ¼ëª…ì„ ì ì–´ë„ ë¨
        				u.setPassword(rs.getString(3));
        				u.setAge(rs.getInt(4));
        				u.setEmail(rs.getString(5));
        				
        				System.out.println(u.toString());
        			}
        			rs.close();
        			pstmt.close();			
        		}catch(Exception e) {}
        		conn.close();
        	}
        }
        
        ```
        
    
- Boardì—ì„œ ê²Œì‹œë¬¼ ì •ë³´ë¥¼ ê°€ì ¸ì™€ ì½˜ì†”ì— ì¶œë ¥
    1. ê²Œì‹œë¬¼ ì •ë³´ë¥¼ ë°›ì„ ê°ì²´ ìƒì„±(User í´ë˜ìŠ¤ ìƒì„±)- getter / setter
        
        ```java
        package boards;
        
        import java.sql.Blob;
        import java.util.Date;
        
        public class Board {
        	private int bno; 
        	private String btitle;
        	private String bcontent; 
        	private String bwriter;
        	private Date bdate;
        	private String bfilename; 
        	private Blob bfiledata;
        	public int getBno() {
        		return bno;
        	}
        	@Override
        	public String toString() {
        		return btitle+" "+bwriter;
        	}
        	
        	public void setBno(int bno) {
        		this.bno = bno;
        	}
        	public String getBtitle() {
        		return btitle;
        	}
        	public void setBtitle(String btitle) {
        		this.btitle = btitle;
        	}
        	public String getBcontent() {
        		return bcontent;
        	}
        	public void setBcontent(String bcontent) {
        		this.bcontent = bcontent;
        	}
        	public String getBwriter() {
        		return bwriter;
        	}
        	public void setBwriter(String bwriter) {
        		this.bwriter = bwriter;
        	}
        	public Date getBdate() {
        		return bdate;
        	}
        	public void setBdate(Date bdate) {
        		this.bdate = bdate;
        	}
        	public String getBfilename() {
        		return bfilename;
        	}
        	public void setBfilename(String bfilename) {
        		this.bfilename = bfilename;
        	}
        	public Blob getBfiledata() {
        		return bfiledata;
        	}
        	public void setBfiledata(Blob bfiledata) {
        		this.bfiledata = bfiledata;
        	}
        }
        ```
        
    2. SELECT ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì •ë³´ ë°›ê¸° + boards í…Œì´ë¸”ì— ìˆëŠ” ì´ë¯¸ì§€ ë‹¤ë¥¸ í´ë”ë¡œ ì €ì¥
        
        ```java
        package boards;
        
        import java.io.FileOutputStream;
        import java.io.InputStream;
        import java.io.OutputStream;
        import java.sql.Blob;
        import java.sql.Connection;
        import java.sql.DriverManager;
        import java.sql.PreparedStatement;
        import java.sql.ResultSet;
        import java.sql.SQLException;
        
        public class BoardSelect {
        	public static void main(String[] args) throws SQLException {
        		Connection conn = null;
        
        		try {
        			Class.forName("com.mysql.cj.jdbc.Driver");
        			conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/sjh", "root", "1234");
        			
        			String sql ="SELECT *FROM boards WHERE bno=?";
        			PreparedStatement pstmt = conn.prepareStatement(sql);
        			pstmt.setInt(1, 2); //bnoê°’ì´ 2ì¸ í…Œì´ë¸” ë°ì´í„° ë‹¤ ê°€ì ¸ì˜´
        			
        			ResultSet rs = pstmt.executeQuery();
        			while(rs.next()) {
        				Board bo = new Board();
        				bo.setBno(rs.getInt(1));
        				bo.setBtitle(rs.getString(2));
        				bo.setBcontent(rs.getString(3));
        				bo.setBwriter(rs.getString(4));
        				bo.setBdate(rs.getDate(5));
        				bo.setBfilename(rs.getString(6));
        				bo.setBfiledata(rs.getBlob(7));
        				
        				System.out.println(bo);
        				
        				Blob b = bo.getBfiledata();
        				if(b!=null) { //ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ìš°
        					InputStream is = b.getBinaryStream(); //isì—ì„œ ì´ë¯¸ì§€ ì½ì–´ë“œë¦¼
        					OutputStream os = new FileOutputStream("C://b/"+bo.getBfilename()); 
        					//Cë“œë¼ì´ë²„ì˜ bí´ë”ì— ì €ì¥
        					
        					is.transferTo(os); //isì—ì„œ ì½ì–´ë“¤ì¸ ì´ë¯¸ì§€ ë³µì‚¬í•˜ê² ë‹¤
        					os.flush();
        					os.close();
        					is.close();
        				}
        			}
        			rs.close();
        			pstmt.close();			
        		}catch(Exception e) {}
        		conn.close();
        	}
        }
        ```
        

### ë°ì´í„° ì½ê¸°

### ResultSet

- êµ¬ì¡°: SELECTë¬¸ì— ê¸°ìˆ ëœ ì»¬ëŸ¼ìœ¼ë¡œ êµ¬ì„±ëœ í–‰ì˜ ì§‘í•¨
    
    <aside>
    ğŸ—£ ResultSet rs = psmt.executeQuery();
    
    </aside>
    
- ResultSet: SELECTë¬¸ì— ê¸°ìˆ ëœ ì»¬ëŸ¼ìœ¼ë¡œ êµ¬ì„±ëœ í–‰ì˜ ì§‘í•©
- next(): ì²« ë²ˆì§¸ ë°ì´í„° í–‰ì¸ firstí–‰ì„ ì½ìœ¼ë©´ì„œ ì»¤ì„œ ì´ë™, ë°˜í™˜í˜• boolean
           nê°œ ë°ì´í„° í–‰ì¼ ê²½ìš°: while(rs.next())
           1ê°œ ë°ì´í„° í–‰ì¼ ê²½ìš°: if(rs.next())
    
    <aside>
    ğŸ—£ boolean result = rs.next();
    
    </aside>
    
- ì»¬ëŸ¼ëª…(rs.getSrting(userid)) ë˜ëŠ” ì»¬ëŸ¼ ìˆœë²ˆ(rs.getSrting(1))ìœ¼ë¡œ ì½ì„ ìˆ˜ ìˆìŒ